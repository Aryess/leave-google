// Generated by CoffeeScript 1.8.0
var Photo, cozydb, log, _;

cozydb = require('cozydb');

_ = require('lodash');

log = require('printit')({
  prefix: 'photomodel'
});

module.exports = Photo = cozydb.getModel('Photo', {
  id: String,
  title: String,
  description: String,
  orientation: Number,
  binary: function(x) {
    return x;
  },
  _attachments: Object,
  albumid: String,
  date: String
});

Photo.createIfNotExist = function(photo, callback) {
  return Photo.request('byTitle', {
    key: photo.title
  }, function(err, photos) {
    var exist;
    exist = _.find(photos, function(fetchedPhoto) {
      return photo.albumid === fetchedPhoto.albumid;
    });
    if (exist) {
      log.debug("" + photo.title + " already imported");
      exist.exist = true;
      return callback(null, exist);
    } else {
      return Photo.create(photo, callback);
    }
  });
};
