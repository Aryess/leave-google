// Generated by CoffeeScript 1.8.0
var Photo, cozydb, _;

cozydb = require('cozydb');

_ = require('lodash');

module.exports = Photo = cozydb.getModel('Photo', {
  id: String,
  title: String,
  description: String,
  orientation: Number,
  binary: function(x) {
    return x;
  },
  _attachments: Object,
  albumid: String,
  date: String
});

Photo.createIfNotExist = function(photo, callback) {
  return Photo.request('byTitle', {
    key: photo.title
  }, function(err, photos) {
    var exist;
    exist = _.find(photos, function(fetchedPhoto) {
      return photo.albumid === fetchedPhoto.albumid;
    });
    if (exist) {
      return callback(null, exist);
    } else {
      return Photo.create(photo, callback);
    }
  });
};
